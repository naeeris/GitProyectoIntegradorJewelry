<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <title>Listado de usuarios</title>

 
    <!--HAGO LA LLAMADA DESDE JAVASCRIPT-->
    <script>

		/* COMENTO ESTO PARA AÑADIR LA ABREVIATURA
	        //Cuando se cargue la página quiero que me saque una función
	        function llamada(){
	
	           
	            let xhr = new XMLHttpRequest();  //Esto funciona en segundo plano, el cliente no se entera de que está haciendo cosas
	            let resultados;
	
	            //Este método controla el cambio de JSON
	            xhr.onreadystatechange = function(){ // Ejecuta cada estado de la conexión, la última es la 4
	                if (xhr.readyState === 4){ //Cuando llegues al estado 4, quiero que hagas lo siguiente:
	                    if (xhr.status === 200){ //el 200 significa que todo está bien (p.ej cuando te sale un error 404, si lo quisiera manejar puedes hacerlo desde este punto)
	                        try{
	                            resultados = JSON.parse(xhr.responseText);
	                        }catch(e){
	                            // TODO: handle exception
	                        }
	                        
	                    }
	                }
	            }
	            xhr.open("GET", "Sv_ListarUsuarios", false); //Este método sirve para indicar a dónde va a ir
	            xhr.setRequestHeader("Content-Type", "application/json"); //OPCIONAL pero está más fino
	            xhr.send(); //Este sirve para que se ponga en marcha
	            
	            pintar(resultados);
	
	        }
		*/
		
		function llamada(){
			fetch('Sv_ListarUsuarios')
			.then(response => response.json())
			.then(data => pintar(data))
		}
		
        function pintar(resultados){
			
			console.log(resultados); //Para comprobar si me saca los datos (DE MOMENTO NO ME LOS SACA)

            let html = "<table border=1>";

            for(let i=0; i<resultados.length; i++){

                html += "<tr><td>"+resultados[i].nombre+"</td></tr>"
            }

            html += "</table>";

            document.getElementById("listado_usuarios").innerHTML = html;

        }

        //Gestor de eventos. Cuando el objeto window se ejecute, cuando haya leído todo, quiero que me ejecutes la siguiente función anónima
        //Quiero que cuando mi ventana (window) se cargue (onload), me ejecutes 'function'
        window.onload = function(){

            llamada();

        }


    </script> 
    
</head>

<body>

	<section>
		<h1>Listado de usuarios</h1>
    
    	<div id="listado_usuarios">


   		</div>
		
	</section>
    
    
    

</body>

</html>